package br.com.pixel3.pixel3list;

import android.app.Activity;
import android.app.AlertDialog;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.EditText;
import android.widget.ToggleButton;
import br.com.pixel3.pixel3list.dao.UsuarioDAO;
import br.com.pixel3.pixel3list.modelo.Usuario;
import br.com.pixel3.pixel3list.util.Pixel3ListUtil;

public class MeusDados extends Activity {
	
	private Button btnSalvar;
	private UsuarioDAO dao;
	private Usuario usuario;
	private EditText editEscola;
	private EditText editEmail;
	private ToggleButton toggleSexo;
	private EditText editSenha;
	private EditText editNome;
	private EditText editLogin;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.meusdados) ;

		dao = new UsuarioDAO (MeusDados.this) ;
		
		editLogin = (EditText) findViewById(R.id.editLogin) ;
		editNome = (EditText) findViewById(R.id.editNome) ;
		editSenha = (EditText) findViewById(R.id.editSenha) ;
		toggleSexo = (ToggleButton) findViewById(R.id.toggleSexo) ;
		editEmail = (EditText) findViewById(R.id.editEmail) ;
		editEscola = (EditText) findViewById(R.id.editEscola) ;
		
		if ( new Pixel3ListUtil(this).isPrimeiroAcesso() ) {
			AlertDialog.Builder builder = new AlertDialog.Builder(this);
			
			StringBuilder sb = new StringBuilder() ;
			sb.append("CONTRATO DE LICENÇA DE USUÁRIO FINAL COMPLEMENTAR PARA  APLICATIVOS PIXEL³ ('EULA Complementar')") ;
			sb.append("IMPORTANTE: LEIA COM ATENÇÃO – Este aplicativo ('PixelList'), inclusive toda documentação 'on-line' ou eletrônica ('Componentes do Aplicativo') estão sujeitos aos termos e condições do contrato sob o qual você aceitou a isntalação descrita abaixo (cada um deles um 'Contrato de Licença de Usuário Final' ou 'EULA') e aos termos e condições deste EULA Complementar. AO INSTALAR, COPIAR OU DE OUTRO MODO USAR OS COMPONENTES DO APLICATIVO, VOCÊ ESTÁ CONCORDANDO EM VINCULAR-SE AOS TERMOS E CONDIÇÕES DO EULA DO APLICATIVO APLICÁVEL E DESTA EULA COMPLEMENTAR. SE VOCÊ NÃO CONCORDAR COM ESTES TERMOS E CONDIÇÕES, NÃO INSTALE, COPIE OU USE APLICATIVO.") ;
			sb.append("sb.append('* A PIXEL³ MOBI retém todos os direitos, titularidade e interesses relacionados aos Componentes do aplicativo. Todos os direitos que não estejam expressamente concedidos são reservados à Pixel³ Mobi.") ;
			sb.append("* A Pixel³ Mobi se ausenta de qualquer responsabilidade por incompatibilidade de hardware ou por mau uso por parte do usuário.") ;
			sb.append("* Este aplicativo é destribuido de forma grauita, por tanto não nos comprometemos com atualizações e manutenção do mesmo.") ;
			
			builder.setMessage(sb.toString());
			builder.setNeutralButton("OK", null);
			AlertDialog dialog = builder.create();
			dialog.setTitle("EULA");
			dialog.show();
		}

		usuario = dao.getUsuarioPorId(1) ;
		if ( usuario.getId() != 0 ) {
			editLogin.setText(usuario.getLogin()) ;
			editNome.setText(usuario.getNome()) ;
			editSenha.setText(usuario.getSenha()) ;
			toggleSexo.setText(usuario.getSexo()) ;
			editEmail.setText(usuario.getEmail()) ;
			editEscola.setText(usuario.getEscola()) ;
		}
		
		btnSalvar = (Button) findViewById(R.id.btnSalvar) ;
		btnSalvar.setOnClickListener(new OnClickListener() {
			public void onClick(View v) {
				
				usuario.setLogin(editLogin.getEditableText().toString()) ;
				usuario.setSenha(editSenha.getEditableText().toString()) ;
				usuario.setSexo(toggleSexo.getText().toString()) ;
				usuario.setEmail(editEmail.getEditableText().toString()) ;
				usuario.setEscola(editEscola.getEditableText().toString()) ;
				usuario.setNome(editNome.getEditableText().toString()) ;
				
				dao.salvarOuAtualizar(usuario) ;
				
				startActivity(new Intent(MeusDados.this, Chamada.class)) ;
				finish() ;
			}
		}) ;
	}
	
	@Override
	protected void onDestroy() {
		super.onDestroy();
		dao.close () ;
	}

}
